<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸšš Rute Tracker - ChauffÃ¸r Dagbog</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; }
    header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; }
    h1 { font-size: 1.8em; margin: 0; }
    .subtitle { font-size: 0.9em; opacity: 0.9; }
    .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
    .tabs { background: white; display: flex; border-bottom: 2px solid #e0e0e0; overflow-x: auto; }
    .tab { padding: 15px 20px; cursor: pointer; border: none; background: none; font-weight: 600; color: #999; border-bottom: 3px solid transparent; white-space: nowrap; }
    .tab.active { color: #667eea; border-bottom-color: #667eea; }
    .tab-content { display: none; padding: 20px; }
    .tab-content.active { display: block; }
    .card { background: white; padding: 20px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    label { display: block; font-weight: 600; margin: 0 0 5px 0; }
    input, select, textarea { width: 100%; padding: 8px; border: 1px solid #d0d0d0; border-radius: 4px; font-family: inherit; }
    button { padding: 10px 16px; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; }
    .btn-primary { background: #667eea; color: white; }
    .btn-primary:hover { background: #5568d3; }
    .notification { position: fixed; top: 80px; right: 20px; background: #667eea; color: white; padding: 15px 20px; border-radius: 4px; z-index: 1000; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th { background: #667eea; color: white; padding: 10px; text-align: left; }
    td { border: 1px solid #e0e0e0; padding: 10px; }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <h1>ğŸšš Rute Tracker</h1>
      <p class="subtitle">ChauffÃ¸r dagbog med Skat & Acubiz integration</p>
    </div>
  </header>

  <div class="tabs">
    <button class="tab active" onclick="switchTab('input')">ğŸ“ Daglig Indtastning</button>
    <button class="tab" onclick="switchTab('history')">ğŸ“… Historik</button>
    <button class="tab" onclick="switchTab('skat')">ğŸ’° Skat Befordring</button>
  </div>

  <div class="container">
    <div id="input" class="tab-content active">
      <div class="card">
        <h2>Registrer Dagens KÃ¸rsler</h2>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
          <div>
            <label>Dato</label>
            <input type="date" id="dateInput">
          </div>
          <div>
            <label>ChauffÃ¸r</label>
            <input type="text" id="driverName" placeholder="Dit navn">
          </div>
        </div>

        <label>VÃ¦lg Ruter</label>
        <select id="routeSelect" multiple size="6"></select>

        <div id="selectedRoutes" style="margin-top: 20px;"></div>

        <div style="display: flex; gap: 10px; margin-top: 20px;">
          <button class="btn-primary" onclick="saveDailyTrip()">âœ… Gem Dagens KÃ¸rsler</button>
        </div>
      </div>
    </div>

    <div id="history" class="tab-content">
      <div class="card">
        <h2>ğŸ“… Historik</h2>
        <div id="historyContent"></div>
      </div>
    </div>

    <div id="skat" class="tab-content">
      <div class="card">
        <h2>ğŸ’° Skat Befordringsfradrag</h2>
        <div id="skatContent"></div>
      </div>
    </div>
  </div>

  <script>
    const HOME = 'RosenvÃ¦nget 2A, 4640 Faxe';
    let trips = [];
    let routes = [];
    let selected = [];

    function init() {
      loadTrips();
      loadRoutes();
      document.getElementById('dateInput').value = new Date().toISOString().split('T')[0];
      document.getElementById('routeSelect').addEventListener('change', updateSelected);
    }

    function loadRoutes() {
      routes = [
        { id: '4640-01', start: 'Vestergade 1, Faxe', end: 'Ã˜strÃ¥gade 50, Faxe', houses: 240, km: 12.5, time: 180 },
        { id: '4640-02', start: 'NÃ¸rregade 1, Faxe', end: 'Sydgade 40, Faxe', houses: 210, km: 11.2, time: 165 },
        { id: '4640-03', start: 'Bogekrattet 5, Faxe', end: 'Voldstokken 25, Faxe', houses: 85, km: 18.7, time: 140 },
        { id: '4700-01', start: 'Torvet 1, NÃ¦stved', end: 'Ringvej 100, NÃ¦stved', houses: 320, km: 14.3, time: 200 },
        { id: '4700-02', start: 'LindegÃ¥rdsvej 1, NÃ¦stved', end: 'Strandvejen 88, NÃ¦stved', houses: 150, km: 16.5, time: 120 }
      ];
      
      routes.forEach(r => {
        const opt = document.createElement('option');
        opt.value = r.id;
        opt.text = `${r.id} - ${r.start.split(',')[0]}`;
        document.getElementById('routeSelect').appendChild(opt);
      });
    }

    function updateSelected() {
      selected = Array.from(document.getElementById('routeSelect').selectedOptions).map(o => o.value);
      const div = document.getElementById('selectedRoutes');
      div.innerHTML = selected.map((id, i) => {
        const r = routes.find(x => x.id === id);
        return `<div class="card"><strong>Rute ${i+1}: ${r.id}</strong><br>${r.start} â†’ ${r.end}<br>ğŸ‘¥ ${r.houses} | ğŸ›£ï¸ ${r.km}km<textarea id="c${i}" placeholder="Kommentar..."></textarea></div>`;
      }).join('');
    }

    async function saveDailyTrip() {
      const date = document.getElementById('dateInput').value;
      const driver = document.getElementById('driverName').value || 'Ukendt';
      
      if (selected.length === 0) {
        notify('VÃ¦lg mindst en rute');
        return;
      }

      notify('â³ Beregner...');

      const tripRoutes = selected.map((id, i) => ({
        ...routes.find(r => r.id === id),
        comment: document.getElementById(`c${i}`)?.value || ''
      }));

      const kmFrom = await getDistance(HOME, tripRoutes[0].start);
      const kmTo = await getDistance(tripRoutes[tripRoutes.length - 1].end, HOME);

      trips.push({ date, driver, routes: tripRoutes, kmFrom, kmTo });
      localStorage.setItem('trips', JSON.stringify(trips));
      
      notify(`âœ… Gemt! ${(kmFrom + kmTo).toFixed(1)} km`);
      selected = [];
      updateSelected();
    }

    async function getDistance(a, b) {
      try {
        const res = await fetch(`https://router.project-osrm.org/route/v1/driving/${encodeURIComponent(a)};${encodeURIComponent(b)}?overview=false`);
        const data = await res.json();
        if (data.routes?.[0]) return (data.routes[0].distance / 1000).toFixed(1);
      } catch(e) { console.error(e); }
      return 5;
    }

    function switchTab(tab) {
      document.querySelectorAll('.tab-content').forEach(e => e.classList.remove('active'));
      document.querySelectorAll('.tab').forEach(e => e.classList.remove('active'));
      document.getElementById(tab).classList.add('active');
      event.target.classList.add('active');
      if (tab === 'history') showHistory();
      if (tab === 'skat') showSkat();
    }

    function showHistory() {
      const html = trips.map(t => `<div class="card"><h3>${new Date(t.date).toLocaleDateString('da-DK')} - ${t.driver}</h3><table><tr><th>Rute</th><th>Start</th><th>Slut</th><th>Husstande</th></tr>${t.routes.map(r => `<tr><td>${r.id}</td><td>${r.start}</td><td>${r.end}</td><td>${r.houses}</td></tr>`).join('')}</table><p><strong>Skat km:</strong> ${t.kmFrom} + ${t.kmTo} = ${(t.kmFrom + t.kmTo).toFixed(1)}</p></div>`).join('');
      document.getElementById('historyContent').innerHTML = html || 'Ingen data';
    }

    function showSkat() {
      let total = 0;
      const rows = trips.map(t => {
        const sum = parseFloat(t.kmFrom) + parseFloat(t.kmTo);
        total += sum;
        return `<tr><td>${new Date(t.date).toLocaleDateString('da-DK')}</td><td>${t.kmFrom}</td><td>${t.kmTo}</td><td><strong>${sum.toFixed(1)}</strong></td></tr>`;
      }).join('');
      document.getElementById('skatContent').innerHTML = `<table><tr><th>Dato</th><th>Hjemâ†’Start</th><th>Endâ†’Hjem</th><th>I alt</th></tr>${rows}</table><p style="margin-top: 20px;"><strong>Samlet: ${total.toFixed(1)} km</strong></p>`;
    }

    function notify(msg) {
      const div = document.createElement('div');
      div.className = 'notification';
      div.textContent = msg;
      document.body.appendChild(div);
      setTimeout(() => div.remove(), 3000);
    }

    function loadTrips() {
      const stored = localStorage.getItem('trips');
      trips = stored ? JSON.parse(stored) : [];
    }

    init();
  </script>
</body>
</html>
